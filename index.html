<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="msapplication-tap-highlight" content="no">
  <title>DRUM KIT</title>
  <link rel="stylesheet" href="./src/css/ui.css">
  <link rel="stylesheet" href="./src/css/sequencer.css">
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <script type="text/javascript" src="src/js/plugins/ismobile.js"></script>
  <script type="text/javascript" src"src/js/plugins/audioContext-MonkeyPatch.js"></script>
  <script type="text/javascript" src="src/js/plugins/knob.js"></script>
</head>
<body>
  <div id="wrapper">
    <div id="mySequencer" class="expand-mixer">
      <div class="controls">
        <div>
          <a class="toggle-mixer" href="#">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" width="32" height="32">
              <g id="mixer-settings" data-name="mixer-settings">
                <rect y="5" width="32" height="2"/>
                <rect y="15" width="32" height="2"/>
                <rect y="25" width="32" height="2"/>
                <rect x="15" width="4" height="12"/>
                <rect x="22" y="10" width="4" height="12"/>
                <rect x="10" y="20" width="4" height="12"/>
              </g>
            </svg>
          </a>
        </div>
        <div>
          <a id="playBtn" href="#">
            <svg id="play-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 8.1 9.35" width="20" height="20">
              <g data-name="play">
                <polygon class="dark" points="8.1 4.68 0 0 0 9.35 8.1 4.68"/>
              </g>
            </svg>
            <svg id="pause-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 18" width="15" height="18">
              <g data-name="pause">
                <rect class="c71b825d-8545-4da2-9b90-5468112e40bd" width="5" height="18"/>
                <rect class="c71b825d-8545-4da2-9b90-5468112e40bd" x="10" width="5" height="18"/>
              </g>
            </svg>
          </a>
        </div>
        <div class="param param-fader"><label>TEMPO</label><input class="input-slider" name="tempo" type="range" min="30.0" max="160.0" value="120"><div id="tempoMeter" class="meter long">120 bpm</div></div>
        <div class="param param-fader"><label>SWING</label><input class="input-slider" name="swing" type="range" min="0" max="100" value="0"><div id="swingMeter" class="meter">0%</div></div>
        <div class="param param-option">
          <select id='kits'>
            <!--<option value="load" selected>dynamic content</option>-->
          </select>
        </div>
        <div>
          <a class="toggle-bar" href="#">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 21" width="50" height="35">
            	<g id="bar1" data-name="bar1">
            		<rect y="0" width="32" height="1"/>
            		<rect y="5" width="32" height="1"/>
            		<rect y="10" width="32" height="1"/>
            		<rect y="15" width="32" height="1"/>
            		<rect y="20" width="32" height="1"/>
            		<ellipse cx="8.5" cy="15.5" rx="2.5" ry="2.5"/>
            		<ellipse cx="16.5" cy="10.5" rx="2.5" ry="2.5"/>
            		<ellipse cx="24.5" cy="5.5" rx="2.5" ry="2.5"/>
            	</g>
            </svg>
          </a>
          <a class="toggle-bar" href="#">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 21" width="50" height="35">
            	<g id="bar2" data-name="bar2">
            		<rect y="0" width="32" height="1"/>
            		<rect y="5" width="32" height="1"/>
            		<rect y="10" width="32" height="1"/>
            		<rect y="15" width="32" height="1"/>
            		<rect y="20" width="32" height="1"/>
            		<ellipse cx="8.5" cy="15.5" rx="2.5" ry="2.5"/>
            		<ellipse cx="16.5" cy="10.5" rx="2.5" ry="2.5"/>
            		<ellipse cx="24.5" cy="5.5" rx="2.5" ry="2.5"/>
            	</g>
            </svg>
          </a>
        </div>
      </div>
      <div class="tracks">
        <div class="track">
          <div class="name">TRACK</div>
          <div class="params">
            <div class="param param-knob">
              <input class="input-knob verb" type="range" min="0" max="10" value="0" data-width="50" data-height="50" data-angleOffset="220" data-angleRange="280" />
              <label>REVERB</label>
              <div class="meter verbmeter">0</div>
            </div>
            <div class="param param-knob">
              <input class="input-knob delay" type="range" min="0" max="10" value="0" data-width="50" data-height="50" data-angleOffset="220" data-angleRange="280" />
              <label>DELAY</label>
              <div class="meter delaymeter">0</div>
            </div>
            <div class="param param-knob">
              <input class="input-knob volume" type="range" min="0" max="10" value="7" data-width="50" data-height="50" data-angleOffset="220" data-angleRange="280" />
              <label>GAIN</label>
              <div class="meter trackmeter">7</div>
            </div>
            <div class="param param-knob">
              <input class="input-knob pan" type="range" min="-5" max="5" value="0" data-width="50" data-height="50" data-angleOffset="220" data-angleRange="280" />
              <label>PAN</label>
              <!--<div class="meter panmeter">0</div>-->
            </div>
            <div class="checkbox"><div class="switch mute"></div><label>MUTE</label></div>
            <div class="checkbox"><div class="switch solo"></div><label>SOLO</label></div>
          </div>
          <ul class="bar">
            <li>
              <ul class="beat">
                <li class="note on"><div class="status"></div></li>
                <li class="note"><div class="status"></div></li>
                <li class="note"><div class="status"></div></li>
                <li class="note"><div class="status"></div></li>
              </ul>
            </li>
            <li>
              <ul class="beat">
                <li class="note"><div class="status"></div></li>
                <li class="note"><div class="status"></div></li>
                <li class="note"><div class="status"></div></li>
                <li class="note"><div class="status"></div></li>
              </ul>
            </li>
            <li>
              <ul class="beat">
                <li class="note on"><div class="status"></div></li>
                <li class="note"><div class="status"></div></li>
                <li class="note"><div class="status"></div></li>
                <li class="note"><div class="status"></div></li>
              </ul>
            </li>
            <li>
              <ul class="beat">
                <li class="note"><div class="status"></div></li>
                <li class="note"><div class="status"></div></li>
                <li class="note"><div class="status"></div></li>
                <li class="note"><div class="status"></div></li>
              </ul>
            </li>
          </ul>
        </div><!--END TRACK-->
        <div class="track">
          <div class="name">TRACK</div>
          <div class="params">
            <div class="param param-knob">
              <input class="input-knob verb" type="range" min="0" max="10" value="0" data-width="50" data-height="50" data-angleOffset="220" data-angleRange="280" />
              <label>REVERB</label>
              <div class="meter verbmeter">0</div>
            </div>
            <div class="param param-knob">
              <input class="input-knob delay" type="range" min="0" max="10" value="0" data-width="50" data-height="50" data-angleOffset="220" data-angleRange="280" />
              <label>DELAY</label>
              <div class="meter delaymeter">0</div>
            </div>
            <div class="param param-knob">
              <input class="input-knob volume" type="range" min="0" max="10" value="7" data-width="50" data-height="50" data-angleOffset="220" data-angleRange="280" />
              <label>GAIN</label>
              <div class="meter trackmeter">7</div>
            </div>
            <div class="param param-knob">
              <input class="input-knob pan" type="range" min="-5" max="5" value="0" data-width="50" data-height="50" data-angleOffset="220" data-angleRange="280" />
              <label>PAN</label>
              <!--<div class="meter panmeter">0</div>-->
            </div>
            <div class="checkbox"><div class="switch mute"></div><label>MUTE</label></div>
            <div class="checkbox"><div class="switch solo"></div><label>SOLO</label></div>
          </div>
          <ul class="bar">
            <li>
              <ul class="beat">
                <li class="note"><div class="status"></div></li>
                <li class="note"><div class="status"></div></li>
                <li class="note"><div class="status"></div></li>
                <li class="note"><div class="status"></div></li>
              </ul>
            </li>
            <li>
              <ul class="beat">
                <li class="note on"><div class="status"></div></li>
                <li class="note"><div class="status"></div></li>
                <li class="note"><div class="status"></div></li>
                <li class="note"><div class="status"></div></li>
              </ul>
            </li>
            <li>
              <ul class="beat">
                <li class="note"><div class="status"></div></li>
                <li class="note"><div class="status"></div></li>
                <li class="note"><div class="status"></div></li>
                <li class="note"><div class="status"></div></li>
              </ul>
            </li>
            <li>
              <ul class="beat">
                <li class="note on"><div class="status"></div></li>
                <li class="note"><div class="status"></div></li>
                <li class="note"><div class="status"></div></li>
                <li class="note"><div class="status"></div></li>
              </ul>
            </li>
          </ul>
        </div><!--END TRACK-->
        <div class="track">
          <div class="name">TRACK</div>
          <div class="params">
            <div class="param param-knob">
              <input class="input-knob verb" type="range" min="0" max="10" value="0" data-width="50" data-height="50" data-angleOffset="220" data-angleRange="280" />
              <label>REVERB</label>
              <div class="meter verbmeter">0</div>
            </div>
            <div class="param param-knob">
              <input class="input-knob delay" type="range" min="0" max="10" value="0" data-width="50" data-height="50" data-angleOffset="220" data-angleRange="280" />
              <label>DELAY</label>
              <div class="meter delaymeter">0</div>
            </div>
            <div class="param param-knob">
              <input class="input-knob volume" type="range" min="0" max="10" value="7" data-width="50" data-height="50" data-angleOffset="220" data-angleRange="280" />
              <label>GAIN</label>
              <div class="meter trackmeter">7</div>
            </div>
            <div class="param param-knob">
              <input class="input-knob pan" type="range" min="-5" max="5" value="0" data-width="50" data-height="50" data-angleOffset="220" data-angleRange="280" />
              <label>PAN</label>
              <!--<div class="meter panmeter">0</div>-->
            </div>
            <div class="checkbox"><div class="switch mute"></div><label>MUTE</label></div>
            <div class="checkbox"><div class="switch solo"></div><label>SOLO</label></div>
          </div>
          <ul class="bar">
            <li>
              <ul class="beat">
                <li class="note on"><div class="status"></div></li>
                <li class="note"><div class="status"></div></li>
                <li class="note on"><div class="status"></div></li>
                <li class="note"><div class="status"></div></li>
              </ul>
            </li>
            <li>
              <ul class="beat">
                <li class="note on"><div class="status"></div></li>
                <li class="note"><div class="status"></div></li>
                <li class="note on"><div class="status"></div></li>
                <li class="note"><div class="status"></div></li>
              </ul>
            </li>
            <li>
              <ul class="beat">
                <li class="note on"><div class="status"></div></li>
                <li class="note"><div class="status"></div></li>
                <li class="note on"><div class="status"></div></li>
                <li class="note"><div class="status"></div></li>
              </ul>
            </li>
            <li>
              <ul class="beat">
                <li class="note on"><div class="status"></div></li>
                <li class="note"><div class="status"></div></li>
                <li class="note"><div class="status"></div></li>
                <li class="note"><div class="status"></div></li>
              </ul>
            </li>
          </ul>
        </div><!--END TRACK-->
        <div class="track">
          <div class="name">TRACK</div>
          <div class="params">
            <div class="param param-knob">
              <input class="input-knob verb" type="range" min="0" max="10" value="0" data-width="50" data-height="50" data-angleOffset="220" data-angleRange="280" />
              <label>REVERB</label>
              <div class="meter verbmeter">0</div>
            </div>
            <div class="param param-knob">
              <input class="input-knob delay" type="range" min="0" max="10" value="0" data-width="50" data-height="50" data-angleOffset="220" data-angleRange="280" />
              <label>DELAY</label>
              <div class="meter delaymeter">0</div>
            </div>
            <div class="param param-knob">
              <input class="input-knob volume" type="range" min="0" max="10" value="7" data-width="50" data-height="50" data-angleOffset="220" data-angleRange="280" />
              <label>GAIN</label>
              <div class="meter trackmeter">7</div>
            </div>
            <div class="param param-knob">
              <input class="input-knob pan" type="range" min="-5" max="5" value="0" data-width="50" data-height="50" data-angleOffset="220" data-angleRange="280" />
              <label>PAN</label>
              <!--<div class="meter panmeter">0</div>-->
            </div>
            <div class="checkbox"><div class="switch mute"></div><label>MUTE</label></div>
            <div class="checkbox"><div class="switch solo"></div><label>SOLO</label></div>
          </div>
          <ul class="bar">
            <li>
              <ul class="beat">
                <li class="note"><div class="status"></div></li>
                <li class="note"><div class="status"></div></li>
                <li class="note"><div class="status"></div></li>
                <li class="note"><div class="status"></div></li>
              </ul>
            </li>
            <li>
              <ul class="beat">
                <li class="note"><div class="status"></div></li>
                <li class="note"><div class="status"></div></li>
                <li class="note"><div class="status"></div></li>
                <li class="note"><div class="status"></div></li>
              </ul>
            </li>
            <li>
              <ul class="beat">
                <li class="note on"><div class="status"></div></li>
                <li class="note"><div class="status"></div></li>
                <li class="note"><div class="status"></div></li>
                <li class="note"><div class="status"></div></li>
              </ul>
            </li>
            <li>
              <ul class="beat">
                <li class="note"><div class="status"></div></li>
                <li class="note"><div class="status"></div></li>
                <li class="note on"><div class="status"></div></li>
                <li class="note"><div class="status"></div></li>
              </ul>
            </li>
          </ul>
        </div><!--END TRACK-->
      </div><!-- END TRACKS -->
      <div class="track" id="reverb">
        <div class="name">REVERB</div>
        <div class="params">
          <div class="param param-option">
            <select id="verbs">
              <option value="blank">five columns long</option>
              <option class="white" value="white">really large cathedral</option>
              <option class="red" value="red">nice drum room</option>
              <option class="blue" value="blue">large wide echo hall</option>
            </select>
          </div>
          <div class="checkbox">
            <div class="switch reverb"></div><label>ON/OFF</label>
          </div>
        </div>
      </div>
      <div class="track" id="delay">
        <div class="name">DELAY</div>
        <div class="params">
          <div class="param param-knob">
            <input class="input-knob" name="time" type="range" min="0" max="100" value="50" data-width="50" data-height="50" data-angleOffset="220" data-angleRange="280" />
            <label>TIME</label>
            <div class="meter" id="timeMeter">0.5</div>
          </div>
          <div class="param param-knob">
            <input class="input-knob" name="feedback" type="range" min="0" max="95" value="50" data-width="50" data-height="50" data-angleOffset="220" data-angleRange="280" />
            <label>FEEDBACK</label>
            <div class="meter" id="feedMeter">0.5</div>
          </div>
          <div class="param param-knob">
            <input class="input-knob" name="freq" type="range" min="0" max="40" value="10" data-width="50" data-height="50" data-angleOffset="220" data-angleRange="280" />
            <label>FREQUENCY</label>
            <div class="meter" id="freqMeter">1000</div>
          </div>
          <div class="checkbox">
            <div class="switch delaytoggle"></div><label>ON/OFF</label>
          </div>
        </div>
      </div>
      <div class="track" id="compressor">
        <div class="name">COMPRESSOR</div>
        <div class="params">
          <div class="param param-knob">
            <input class="input-knob" name="threshold" type="range" min="-100" max="0" value="50" data-width="50" data-height="50" data-angleOffset="220" data-angleRange="280" />
            <label>THRESHOLD</label>
            <div class="meter" id="thresholdMeter">-24</div>
          </div>
          <div class="param param-knob">
            <input class="input-knob" name="knee" type="range" min="0" max="40" value="30" data-width="50" data-height="50" data-angleOffset="220" data-angleRange="280" />
            <label>KNEE</label>
            <div class="meter" id="kneeMeter">30</div>
          </div>
          <div class="param param-knob">
            <input class="input-knob" name="ratio" type="range" min="1" max="20" value="12" data-width="50" data-height="50" data-angleOffset="220" data-angleRange="280" />
            <label>RATIO</label>
            <div class="meter" id="ratioMeter">12</div>
          </div>
          <div class="param param-knob">
            <input class="input-knob" name="attack" type="range" min="0" max="100" value=".01" data-width="50" data-height="50" data-angleOffset="220" data-angleRange="280" />
            <label>ATTACK</label>
            <div class="meter" id="attackMeter">0.01</div>
          </div>
          <div class="param param-knob">
            <input class="input-knob" name="release" type="range" min="1" max="100" value="25" data-width="50" data-height="50" data-angleOffset="220" data-angleRange="280" />
            <label>RELEASE</label>
            <div class="meter" id="releaseMeter">0.25</div>
          </div>
          <div class="checkbox">
            <!--<input type="checkbox" name="compressor" value="0" id="cmprsr" class="switch compressor"/> <label for="cmprsr">ON/OFF</label>-->
            <div class="switch compressor"></div><label>ON/OFF</label>
          </div>
        </div>
      </div>
      <div id="mixer">
        <div class="track" id="wetmix">
          <div class="name">WET MIX</div>
          <div class="params">
            <div class="param param-fader">
              <input class="input-fader" name="wet" type="range" min="0" max="100" value="70" />
              <div id="wetMeter" class="meter">7</div>
            </div>
            <div class="checkbox">
              <div class="switch mute"></div><label>MUTE</label>
            </div>
          </div>
        </div>
        <div class="track" id="drymix">
          <div class="name">DRY MIX</div>
          <div class="params">

            <div class="param param-fader">
              <input class="input-fader" name="dry" type="range" min="0" max="100" value="70" />
              <div id="dryMeter" class="meter">7</div>
            </div>
            <div class="checkbox">
              <div class="switch mute"></div><label>MUTE</label>
            </div>
          </div>
        </div>
        <div class="track" id="global">
          <div class="name">MASTER</div>
          <div class="params">
            <div class="param param-fader">
              <input id="master" class="input-fader" name="volume" type="range" min="0" max="100" value="70" step="1" list="volsettings"/>

              <datalist id="volsettings">
              	<option>0</option>
              	<option>20</option>
              	<option>40</option>
              	<option>60</option>
              	<option>80</option>
              	<option>100</option>
              </datalist>
              <div id="volumeMeter" class="meter">7</div>
            </div>
          </div>
        </div>
      </div>
    </div><!-- END SEQUNECER -->
  </div><!-- END WRAPPER -->
  <script src="src/js/Sample.js"></script>
  <script src="src/js/Delay.js"></script>
  <script src="src/js/Reverb.js"></script>
  <script src="src/js/Compressor.js"></script>
  <script src="src/js/Track.js"></script>
  <script src="src/js/Mixer.js"></script>
  <script src="src/js/Sequencer.js"></script>
  <script src="src/js/Visualizer.js"></script>
  <script src="src/js/Ui.js"></script>
  <script src="src/js/drumr.js"></script>
  <script>

  let jsonToLoad;
    // set up knobs
    function setUI(){
      let tracks = document.getElementsByClassName('track');
      for (let i = 0; i<tracks.length; i++){
        let sliders = tracks[i].getElementsByClassName('input-knob');
        for (let j = 0; j<sliders.length;j++){
          //console.log(sliders[j]);
          new Knob(sliders[j], new Ui.Knob());
        }
      }
    }
    setUI();
  //buildOptionLists

    function setOptions(eleID, arr){
      let selectElement = $('#'+eleID);
      selectElement.empty();
      $.each(arr, function(index, value) {
       var option = $('<option></option>');
       option.attr('value', index);
       option.text(arr[index].name);
       selectElement.append(option);
     });
    }

    //stop bouncy page in ios
    let firstMove;
    $(document).on('touchstart', function(e) {
      firstMove = true;
    });

    $(document).on('touchmove', function(e) {
      if (firstMove){
        e.preventDefault();
        firstMove = false;
      }
     }
    );
    // doc ready
    $( document ).ready(function() {
      jsonToLoad = 2;
      $.getJSON("json/kits.json", function(json) {
        setOptions('kits', json);
        initLib('kits', json);
        jsonToLoad--;
        if (jsonToLoad === 0) initDrumr();
      });

      $.getJSON("json/verbs.json", function(json) {
        setOptions('verbs', json);
        initLib('verbs', json);
        jsonToLoad--;
        if (jsonToLoad === 0) initDrumr();
      });

    });
  </script>

</body>
</html>
